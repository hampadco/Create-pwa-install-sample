
 

<script src="~/js/Chart.min.js"></script>
<script src="~/js/jquery-3.6.0.min.js"></script>
<script src="~/js/signalr.min.js"></script>


<div class="row p-3">

  <div class="col-6 text-center">

    <p class="text-center alert alert-success" id="puls">--</p>

  </div>

  <div class="col-6 text-center">

    <p class="text-center alert alert-warning" id="so">--</p>

  </div>

</div>

<canvas id="serial-port-data-chart" style="margin-top:5px"></canvas>
<div class="text-center">
  <button id="startBtn" class="btn btn-success">Start Connection</button>
  <button id="stopBtn" class="btn btn-danger">Stop Connection</button>

</div>



<script>
var ctx = document.getElementById("serial-port-data-chart").getContext("2d");
var dataPointLimit =150; // number of data points to display on the chart

var chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Serial Port Data",
      data: [],
      borderColor: "rgba(75, 192, 192, 1)",
      backgroundColor: "rgba(75, 192, 192, 0.2)"
    }]
  },
  options: {
    scales: {
      xAxes: [{
        type: 'realtime',
        realtime: {
          duration: 20000,
          refresh: 1000,
          delay: 2000,
          onRefresh: function(chart) {
            chart.data.labels = chart.data.labels.slice(-dataPointLimit);
            chart.data.datasets.forEach(function(dataset) {
              dataset.data = dataset.data.slice(-dataPointLimit);
            });
          }
        }
      }],
      yAxes: [{
        ticks: {
          beginAtZero: true
        }
      }]
    }
  }
});

var connection = new signalR.HubConnectionBuilder().withUrl("/dataHub").build();

connection.on("ReceiveData", function (data,data1,data2) {
  if (data.trim() !== "") {
    var parsedData = parseFloat(data);
    var now = new Date();
    var time = now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds();

    chart.data.labels.push(time);
    chart.data.datasets[0].data.push(parsedData);
  }
});

connection.start();

document.getElementById("stopBtn").addEventListener("click", function () {
  connection.stop().then(function () {});
});
</script>


